Цель: выполнить тестирование производительности вашего веб-
сервера, чтобы определить, как он работает при большом объеме
запросов и нагрузке.

Задания:
1. Установите и настройте инструменты тестирования
производительности, такие как Apache JMeter или Gatling.


## Установим готовый сайт ice cream
https://gitlab.com/devops201206/ice_cream_store



```bash
git clone https://gitlab.com/devops201206/ice_cream_store.git
cd ice_cream_store
sudo docker compose up -d --build

```
Пришлось менять порт 9100 на 9101 т.к. используется 
```bash
sudo ss -nltp | grep 9100
LISTEN 0      2048         0.0.0.0:9100      0.0.0.0:*    users:(("python3.12",pid=13099,fd=6))  
```

vim compose.yml
```bash
services:
  api:
    build: .
    command: python -m src.app
    ports:
      - 5000:5000
      - 9101:5000 # 9100:5000
    depends_on:

```
запустился докер
```bash

sudo ss -nltp | grep 9101    

LISTEN 0      4096         0.0.0.0:9101      0.0.0.0:*    users:(("docker-proxy",pid=13874,fd=7))               
LISTEN 0      4096            [::]:9101         [::]:*    users:(("docker-proxy",pid=13882,fd=7))
```

Проверка работы сайта

```bash
curl -X POST http://localhost:5000/ice_creams \
  -H "Content-Type: application/json" \
  -d '{"name": "Ванильное", "description": "Классическое ванильное", "price": 2.5, "quantity": 100}'
  
{"id":1}


curl http://localhost:5000/ice_creams
[{"description":"\u041a\u043b\u0430\u0441\u0441\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0432\u0430\u043d\u0438\u043b\u044c\u043d\u043e\u0435","id":1,"name":"\u0412\u0430\u043d\u0438\u043b\u044c\u043d\u043e\u0435","price":2.5,"quantity":100}]


curl -X DELETE http://localhost:5000/ice_creams/1
{"message":"Deleted successfully"}

```


2. Определите основные метрики производительности, которые нужно
измерить, например, время отклика, задержку, пропускную способность и
загрузку процессора.


3. Создайте тестовые сценарии, которые будут имитировать различные
типы пользовательской активности на сайте, например, просмотр страницы,
добавление товара в корзину, оформление заказа и т.д.


4. Задайте параметры для тестовых сценариев, например, количество
пользователей, количество запросов в единицу времени, длительность теста и
т.д.


5. Запустите тест и отслеживайте производительность сервера в режиме
реального времени, собирая данные о времени отклика, задержке,
пропускной способности и загрузке процессора при различных нагрузках.


6. Проанализируйте результаты тестирования, чтобы определить, как
сервер работает при различных нагрузках. Определите максимальную
нагрузку, которую сервер может выдержать, и выявите узкие места в
инфраструктуре.






## Apache JMeter

#### Установка java
Проверка есть ли

```bash
java -version

#если нет
sudo apt update
sudo apt install openjdk-17-jdk

```
##### Добавляем переменную в .bashrc
Копируем путь к java
```bash
sudo update-alternatives --config java
[sudo] password for alrex:
There is 1 choice for the alternative java (providing /usr/bin/java).

  Selection    Path                                         Priority   Status
------------------------------------------------------------
* 0            /usr/lib/jvm/java-17-openjdk-amd64/bin/java   1711      auto mode
  1            /usr/lib/jvm/java-17-openjdk-amd64/bin/java   1711      manual mode

```


```bash

sudo vim ~/.bashrc
#Вставляем в самый верх


# for examples
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64
export PATH=$JAVA_HOME/bin:$PATH

```
Перечитаем
```bash
source ~/.bashrc
```

Проверяем

```bash
echo $JAVA_HOME
/usr/lib/jvm/java-17-openjdk-amd64
```


#### Распаковка запуск Apache JMeter
```bash
 mkdir source
 cd source/
 wget https://dlcdn.apache.org//jmeter/binaries/apache-jmeter-5.6.3.tgz
# open arh
tar xvzf apache-jmeter-5.6.3.tgz

rm apache-jmeter-5.6.3.tgz
cd apache-jmeter-5.6.3/bin

# permition x
ls -l jmeter.sh
-rwxr-xr-x 1 alrex alrex 4155 May  5  2023 jmeter.sh
```
запуск
```bash
./jmeter.sh
```

## Тестирование
Использовалось
https://habr.com/ru/companies/otus/articles/746504/

Большее погружение  оставлю для себя если понадобится.
https://habr.com/ru/articles/261483/

<img width="626"  height="256" alt="image" src="https://github.com/user-attachments/assets/49a68f3f-ac99-49ed-a59c-f9ea194aa831" />

Настройки request (path одинаковый), но используем приём  -GET

<img width="626" height="363" alt="image" src="https://github.com/user-attachments/assets/b14b2852-b44e-44b7-b4e0-7c957c7605aa" />

Где 10000 - пользователей ломятся на сайт в течении 100 секунд одной волной

#### График
<img width="900" height="600" alt="image" src="https://github.com/user-attachments/assets/17711fc1-4478-4887-86a8-9ee8a0b184ff" />

Чтобы проанализировать производительность тестируемого веб-сервера, необходимо сосредоточиться на 2 параметрах:

Пропускная способность (Throughput)

Отклонение/погрешность (Deviation)
Отклонение показано красным цветом — оно указывает на отклонение от среднего значения. Чем меньше, тем лучше.

У меня на сайт пропускная способность  6000 юзеров в минуту


#### Ну видно нагрузку на самом хосте - повышение
<img width="626" height="280" alt="image" src="https://github.com/user-attachments/assets/7a8c00ef-ea88-4f66-a0cb-cc6e4f455071" />



