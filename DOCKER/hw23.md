Домашнее задание №23
Цель: получить практический опыт работы c Docker-командами
Задание 1: Запуск экземпляров приложения с подключением томов и
сети
Цель этого задания - ознакомиться с основами работы с Docker volumes и Docker
network. Также вы научитесь использовать команду docker logs
Шаги:
● Найдите на Docker Hub образ, который вы хотите запустить на вашей
машине.

Поставлю апач
```
whereis httpd
httpd:
```

https://hub.docker.com/_/httpd

docker build -t img:v1 . --no-cache

● Используя команду docker run, запустите контейнер на основе этого
образа. Добавьте флаги, чтобы установить имя контейнера,
перенаправить порты, установить переменные окружения и т.д.
Используйте команду docker ps, чтобы убедиться, что контейнер
запущен.

```
docker run -dit --name my-apache-app -p 8080:80 httpd:2.4

docker images
REPOSITORY   TAG       IMAGE ID       CREATED       SIZE
httpd        2.4       199e3a035264   2 weeks ago   117MB

docker ps
CONTAINER ID   IMAGE       COMMAND              CREATED          STATUS          PORTS                                     NAMES
475ce37ab861   httpd:2.4   "httpd-foreground"   43 seconds ago   Up 40 seconds   0.0.0.0:8080->80/tcp, [::]:8080->80/tcp   my-apache-app

```

● Создайте Docker volume с помощью команды docker volume create.

```
docker volume create vol
docker volume ls

DRIVER    VOLUME NAME
local     37444781b77243574709ac01c4eb0ae5be05689f3756765956be07745b069b68
local     vol
```

● Запустите контейнер, используя команду docker run, и подключите
созданный Docker volume к контейнеру.

```
docker rm my-apache-app -f
docker run -dit --name my-apache-app -p 8080:80 -v /home/alrex/hw/:/usr/local/apache2/hw/ httpd:2.4
```
зайду посмотреть где hw папка 
```
docker exec -it my-apache-app bash

ls
bin  build  cgi-bin  conf  error  htdocs  hw  icons  include  logs  modules

```

● Используйте команду docker network create для создания новой Docker
network.
```
docker network create web-network

docker network ls

NETWORK ID     NAME          DRIVER    SCOPE
545bbe9c547a   bridge        bridge    local
22319440f089   host          host      local
0ba5d3aa129b   none          null      local
3d19c57d49cc   web-network   bridge    local
```

Опционально:


● Создайте второй контейнер из того же образа, используя команду docker run,
и подключите его к созданной Docker network.
```
docker run -dit --name my-apache-app -p 8080:80 --network web-net -v /home/alrex/hw/:/usr/local/apache2/log/ httpd:2.4

docker run -dit --name my-apache -p 8081:80 --network web-net -v /home/alrex/hw/:/usr/local/apache2/log/ httpd:2.4

docker ps

CONTAINER ID   IMAGE       COMMAND              CREATED          STATUS          PORTS                                     NAMES
9dd66cb23faa   httpd:2.4   "httpd-foreground"   11 seconds ago   Up 11 seconds   0.0.0.0:8081->80/tcp, [::]:8081->80/tcp   my-apache
06985f98b31f   httpd:2.4   "httpd-foreground"   24 seconds ago   Up 23 seconds   0.0.0.0:8080->80/tcp, [::]:8080->80/tcp   my-apache-app


```
● Внутри первого контейнера, используя утилиту nano, создайте текстовый
файл в подключенном Docker volume.
```
docker exec -it my-apache-app bash

apt-get update && apt-get install nano -y

nano myfile

cat  myfile
first

exit
```
Смотрим на хосте
```
/home/alrex/apach/hw# cat myfile
first
```


● Внутри первого контейнера, используя утилиту logger, запишите несколько
сообщений в созданный текстовый файл.

Не добавляет в логи
```
logger "INFO: this is message from 1 container" | tee -a /usr/local/apache2/log/myfile
```


Ни как не прокатывает - при просмотре лога нет добавления от logger
```
docker run -dit --name my-apache-app  --network web-network \
--log-driver json-file --log-opt  tag="myapach"\
env=APT --log-opt max-size=10m \
-v /home/alrex/apach/hw/:/usr/local/apache2/log/ -p 8081:80 httpd:2.4

docker logs my-apache-app -f

docker run -dit --name my-apache  --network web-network --log-driver journald  --log-opt tag="myapach" \
 -v /home/alrex/apach/hw/:/usr/local/apache2/log/ -p 8081:80 httpd:2.4

journalctl -u docker CONTAINER_NAME=my-apache -f

```

Сработало только так

```
echo "INFO: this is message from 1 container" | tee -a /usr/local/apache2/log/myfile
INFO: this is message from 1 container

```

● Используйте команду docker logs для просмотра логов первого контейнера и
убедитесь, что сообщения были успешно записаны в лог-файл.
● Используйте команду docker exec для выполнения команды во втором
контейнере и проверьте, что созданный текстовый файл доступен из второго
контейнера.
● Используйте команду docker stop для остановки обоих контейнеров.
● Используйте команду docker rm для удаления контейнеров и команду docker
rmi для удаления образа.
● Используйте команду docker volume rm для удаления Docker volume и
команду docker network rm для удаления Docker network.

```
docker ps -qa | xargs docker rm -f
docker images -qa | xargs docker rmi
docker system prune --all -fa

```

